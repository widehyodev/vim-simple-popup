name: docs

on:
  push:
    branches:
      - main  # 또는 master (기본 브랜치 이름 확인 필요)
    paths:
      - "README.md" # README가 바뀔 때만 실행되도록 최적화
      - ".github/workflows/docs.yml"

jobs:
  docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write # 봇이 doc 폴더에 파일을 쓰고 커밋하려면 필수 권한
    steps:
      - uses: actions/checkout@v4

      - name: panvimdoc
        uses: kdheepak/panvimdoc@main
        with:
          # [중요] 생성될 도움말 파일의 이름입니다. (doc/vim-simple-popup.txt 생성됨)
          vimdoc: vim-simple-popup
          
          # 도움말 파일 상단에 표시될 버전 요구사항
          version: "Vim >= 8.2"
          
          # README의 이모지를 Vim 도움말에서 제거 (깨짐 방지)
          demojify: true
          
          # Treesitter 하이라이팅 지원 여부
          treesitter: true

      - name: Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: auto-generate vimdoc from README"
          branch: ${{ github.head_ref }}
          commit_user_name: "github-actions[bot]"
          commit_user_email: "github-actions[bot]@users.noreply.github.com"
          commit_author: "github-actions[bot] <github-actions[bot]@users.noreply.github.com>"
